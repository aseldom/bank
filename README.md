# Bank

Данный проект представляет собой сервис "банковских операций".

---
## Данное приложение реализует следующий функционал:
- взаимодействие с системой осуществляется с помощью REST запросов
- у каждого пользователя может быть только один банковский аккаунт (создается при добавлении пользователя с указанием начального баланса)
- добавление новых пользователей (осуществляется через служебное АПИ без аутентификации, пример будет приведен далее). У каждого пользователя при регистрации должны быть указаны:
  - логин (userName)
  - пароль (password)
  - ФИО (fullName)
  - дата рождения (birthDate) в формате `yyyy-MM-dd`
  - адреса электронной почты в виде списка (emails)
  - номера телефонов в виде списка (phones)
  - начальный баланс банковского аккаунта (account)
- авторизованный пользователь может осуществлять добавление/удаление/изменение номера телефона, email
- авторизованный пользователь может переводить средства со своего счета на счет другого зарегистрированного пользователя
- авторизованный пользователь может осуществлять поиск/фильтрацию с пагинацией и сортировкой среди всех пользователей зарегистрированных в системе по следующим параметрам:
  - по дате рождения, фильтр записей, где дата рождения больше чем в запросе
  - по номеру телефона (фильтр по 100% совпадению)
  - по email адресу (фильтр по 100% совпадению)
  - по ФИО (фильтр по like формату `‘{text-from-request-param}%’`)
- осуществляется логирование переводов средств с одного счета на другой, а так же основных исключений и ошибок валидации входящих параметров.
- осуществляется валидация входящих параметров
- каждую минуту осуществляется начисление процентов на остаток средств на счете (5%), но не более 207% от начального депозита
- перевод средств со счета на счет является потокобезопасной операцией (optimistic lock)
- на операцию перевода средств написаны интеграционные тесты 

---
#### Для пользователя в базе данных действуют следующие ограничения:

- пользователь может добавлять/менять/удалять следующие данные о себе: email, телефон. Удалить последний телефон/email нельзя. Номер телефон, email является уникальным в системе.
- пользователь может переводить средства только со своего счета на другой счет в системе. Баланс счета не может быть отрицательным. Контроль баланса счета осуществляется как на уровне приложения, так и на уровне БД.
- для неавторизованного пользователя допускается только добавление нового пользователя в систему

---
## Стек технологий
* Java 17
* Spring Boot
* Spring Security
* Spring Data JPA
* MapStruct
* Lombok
* PostgreSQL
* H2 Data Base
* OpenAPI/Swagger
* GitHub Action

---
## Запуск проекта
- Импортировать проект в IntelliJ IDEA
- В PostgreSQL создать БД `bank`
- В `application.properties` выполнить настройки подключения к БД
- В `application.properties` задать требуемый режим работы с БД: `spring.jpa.hibernate.ddl-auto`. По умолчания задано `create-drop`
- Выполнить метод main
- Взаимодействие с приложением осуществляется с помощью REST запросов
- Для доступа к OpenAPI/Swagger необходимо зарегистрировать хотя бы одного пользователя. URL: http://localhost:8080/swagger-ui/index.html

---
## Работа с приложением (пример):
1) Добавление пользователя (URL: http://localhost:8080/api/v1/public/users/create)
```json 
{
"userName" : "userName1",
"password" : "password1",
"fullName" : "fullName1",
"birthDate" : "2024-01-01",
"emails" : [
{
"email" : "email1@example.com"
}
],
"phones" : [
{
"number" : "12312-456-7890"
}
],
"account" : {
"initialDeposit" : 1000.0
}
}
```
#### Все дальнейшие действия с системой могут осуществляться только авторизованным пользователем (login, password).
2) Добавление номера телефона (URL: **POST** http://localhost:8080/api/v1/users/add-phone).
```json
{
  "number": "added phone 123-456-7890"
}
```

3) Удаление номера телефона (URL: **DELETE** http://localhost:8080/api/v1/users/add-phone).
```json
{
  "number": "added phone 123-456-7890"
}
```

4) Изменение номера телефона (URL: **PUT** http://localhost:8080/api/v1/users/change-phone).
```json
{
  "oldPhoneNumber": "added phone 123-456-7890",
  "newPhoneNumber": "new phone 123-456-7890"
}
```

5) Добавление email (URL: **POST** http://localhost:8080/api/v1/users/add-email).
```json
{
  "email": "addedemail@example.com"
}
```

6) Удаление email (URL: **DELETE** http://localhost:8080/api/v1/users/delete-email).
```json
{
  "email": "addedemail@example.com"
}
```

7) Изменение email (URL: **PUT** http://localhost:8080/api/v1/users/change-email).
```json
{
  "oldEmail": "addedemail@example.com",
  "newEmail": "emailNew@example.com"
}
```

8) Перевод средств (URL: **PUT** http://localhost:8080/api/v1/accounts/transfer).
```json
{
  "recipient": "userName1",
  "value": "400"
}
```
9) Поиск/фильтрация пользователей (пример):

   http://localhost:8080/api/v1/users/search?birthDate=1990-01-01&number=123-456-7890&fullName=Иван&email=email@example.com&page=0&size=10&sortBy=fullName&sortDir=asc
---
#### Взаимодействие с приложением удобнее осуществлять через [Postman](https://www.postman.com/)

---
#### Контакты для связи:
* email: a.seldom@gmail.com
* telegram: @aseldom       

             